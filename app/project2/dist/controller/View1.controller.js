sap.ui.define(["sap/ui/core/mvc/Controller","sap/suite/ui/commons/ChartContainer","sap/suite/ui/commons/ChartContainerContent","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/model/json/JSONModel","sap/viz/ui5/controls/VizFrame","sap/ui/unified/ColorPicker","sap/ui/unified/ColorPickerPopover","sap/m/MessageToast","sap/base/Log"],function(e,t,o,a,r,n,i,s,l,d){"use strict";var c;return e.extend("project2.project2.controller.View1",{onInit:function(){var e=this.getOwnerComponent().getModel("mainService");e.read("/Students",{success:function(e){var t=new n;t.setData(e.results);this.getView().setModel(t,"studentsData")}.bind(this),error:function(e){d.error("Error reading Students data: "+e)}});var t=new sap.ui.model.Filter("Dashboard_Name","EQ","dash2");e.read("/Students",{filters:[t],success:function(e){console.log(e.results)},error:function(e){console.error("Error reading filtered Students data: "+e)}})},onOpenColorPicker:function(){var e=this;var t=this.getView().byId("bgColorInput");var o=new sap.ui.unified.ColorPickerPopover({colorString:t.getValue(),change:function(t){var o=t.getParameter("colorString");e.onChangeColor(o)},cancel:function(){o.close()}});o.openBy(this.getView().byId("bgColorInput"))},onChangeColor:function(e){console.log("Selected color:",e);var t=this.getView().byId("bgColorInput");if(t){t.setValue(e)}else{console.error("bgColorInput not found")}},onSave:function(){var e=parseInt(localStorage.getItem("lp"))||0;var t=e+1;localStorage.setItem("lp",t);var o=this.getView().byId("dashname");var a=o.getValue();var r=this.getView().byId("chartTypeComboBox");var n=r.getSelectedKey();var i=this.getView().byId("chartNameInput").getValue();var s=this.getView().byId("measuresComboBox").getSelectedKey();var l=this.getView().byId("dimensionsComboBox").getSelectedKey();var c=this.getView().byId("tableNameInput").getValue();var u=this.getView().byId("bgColorInput").getValue();console.log(u);var g={chart_Type:n,Dashboard_Name:a,Measures:s,Dimensions:l,Chart_Name:i,TableName:c,Color:u};var h=this.getOwnerComponent().getModel("mainService");h.create("/Students",g,{success:function(e,t){console.log("Chart options saved:",e)},error:function(e){d.error("Error saving chart options: "+e)}});this.onPublish()},onPublish:function(){var e=this.getOwnerComponent().getModel("mainService");var t=this.getView().byId("chartTypeComboBox");var o=t.getSelectedKey();var i=this.getView().byId("dashname").getSelectedItem().getKey();var s=this;e.read("/Students",{success:function(t){var o={Root:[]};t.results.forEach(function(e){if(e.Dashboard_Name===i){var t={Dashboard_Name:e.Dashboard_Name,Chart_Name:e.Chart_Name,chart_Type:e.chart_Type,Measures:e.Measures,Dimensions:e.Dimensions,TableName:e.TableName,Color:e.Color,data1:null};o.Root.push(t)}});e.read("/empinfo",{success:function(e){var t=e.results.map(function(e){return{Name:e.Name,Address:e.Address,Salary:e.Salary}});o.Root.forEach(function(e){e.data1=t});var i=new n;i.setData({root1:o});var l=s.getView().byId("chartBlock");if(!l){d.error("Main VBox container not found in the view. Please check if the container ID is correct.");return}var u=(new sap.m.VBox).addStyleClass("sapUiSmallMargin");c=new sap.viz.ui5.controls.VizFrame({id:"vizfr"+l.getItems().length,height:"400px",width:"50%",background:{color:"#F0F0F0"}});console.log(c);c.attachRenderComplete(function(){var e=c.getDomRef().querySelector(".v-m-root");if(e){e.style.background="#F0F0F0"}});var g=i.getProperty("/root1/Root/0/chart_Type");var h=i.getProperty("/root1/Root/0/Chart_Name");var m=i.getProperty("/root1/Root/0/Color");console.log(m);if(g==="column"||g==="bar"||g==="line"||g==="donut"){c.setDataset(new a({dimensions:[{name:"Name",value:"{Name}"}],measures:[{name:"Salary",value:"{Salary}"}],data:{path:"/root1/Root/0/data1"}}));c.setModel(i);c.setVizType(g);c.setVizProperties({plotArea:{colorPalette:["#007181"],gridline:{visible:false}},background:{color:"Skyblue"},legend:{label:{style:{color:"Blue"}}},dataLabel:{visible:true,style:{fontWeight:"bold"},hideWhenOverlap:false},seriesStyle:{rules:[{dataContext:{Budget:"*"},properties:{dataPoint:{pattern:"noFill"}}}]},dataPointStyleMode:"update",dataPointStyle:{rules:[{dataContext:[{Period:{in:["Q1 '18","Q2 '18"]},Actuals:"*"}],properties:{pattern:"diagonalLightStripe"}}]},title:{visible:true,text:h,style:{color:m,fontSize:"18px",fontWeight:"bold"}}});var p=new r({uid:"valueAxis",type:"Measure",values:["Salary"]});var v=new r({uid:"categoryAxis",type:"Dimension",values:["Name"]});c.removeAllFeeds();c.addFeed(p);c.addFeed(v);u.addItem(c);l.addItem(u)}},error:function(e){d.error("Error reading empinfo data: "+e)}})},error:function(e){d.error("Error reading Students data: "+e)}})},handlechange1:function(){console.log("live handlechange1 event is there");var e=this.getView().byId("chartNameInput").getValue();if(c){c.setVizProperties({title:{text:e}})}else{console.log("vizframe not initialized")}},onChangeBackgroundColor:function(){console.log("there is an live change event pressed please brother make sure")}})});